[toc]

# 第三章. Git 分支

## 3.1 分支简介

### 1. 分支简介

Git 把数据看做是对小型文件系统的一组快照。每次提交更新，或在 Git 中保存项目状态时，主要对当时的全部文件制作一个快照并保存这个快照的索引。为了高效，如果文件没有修改， Git 不再重新存储该文件，而是只保留一个链接指向之前存储的文件。 Git 对待数据更像是一个快照流。

暂存操作会为每个文件计算校验和（SHA-1 哈希算法），然后会把当前版本的文件快照保存到 Git 仓库中 （Git 使用blob对象来保存他们）最终将校验和加入到暂存区域等待提交。

```bash
git add
```

当使用 git commit 进行提交操作时， Git 会先计算每一个子目录的校验和，然后在 Git 仓库中将这些校验和保存为树对象。 随后， Git 便会创建一个提交对象，它除了包含上面提到的那些信息外，还包含指向这个树对象的指针。如此一来， Git 就可以在需要的时候重新此次保存的快照

做些修改后再次提交，产生的提交对象就会包含一个指向上次提交对象（父对象）的指针

**Git 的分支，其实本质上仅仅是指向提交对象的可变指针**

### 2. 分支创建

Git 分支，只是创建了一个可以移动的新的指针

```bash
git branch [branch-name]
```

这会在当前所在的提交对象上创建一个指针

那么， Git 又是怎么知道当前是在哪一个分支上呢？也很简单，它有一个名为 HEAD 的特殊指针，指向当前所在的本地分支（译注： 可将 HEAD 想象成当前分支的别名）

```bash
git log --oneline --decorate
# c1ed4f8 (HEAD -> test, origin/test, origin/HEAD)
```

### 3. 分支切换

```bash
git checkout [branch-name]
```

这样，HEAD 就指向切换的分支了

修改后再次提交，会发现 HEAD 分支会随着提交操作自动向前移动

再 切回分支 git checkout master

这条命令就会做两件事情。一是使 HEAD 指回 master 分支，二是将工作目录回复成 master 分支所指向的快照内容。也就是说，你现在做修改的话，项目将始于一个较旧的版本。本质上来讲，这就是忽略 [banch-name]分支所做的修改，以便于向另一个方向进行开发。

然后再修改再提交，提交历史就会产生分叉。可以通过一下命令查看

```bash
git log --online --decorate --graph --all
# 仔细看，能看懂的
```

